# FooS
食(**Foo**d)でつながるソーシャルネットワーク(**S**NS)で、FooS（仮）。もっといいネーミングセンスが欲しい。

## 設計
### データベース設計

アプリケーション内でデータを円滑に処理するためのデータベースの設計指針を以下に記す。

#### 使用技術

データベースには、Firebase Cloud FireStoreを用いる。Cloud FireStoreはNoSQLのデータベースであり、コレクション、ドキュメント、フィールドの3つの概念が登場する。

- コレクション: ドキュメントをまとめたもの。
- ドキュメント: フィールドやサブコレクションをまとめたデータ単位。
- フィールド:　具体的なデータエントリ（`name: "John"`など）

詳細はこちらの公式ドキュメントを参照→https://firebase.google.com/docs/firestore/data-model?hl=ja


#### 具体的な設計方針

タイムラインにおいては、主にフォロー済みユーザーの投稿を読み込んでいくことになるため、ユーザー起点のデータ取得が多く発生する。
一方で、マップ上などでは現在位置周辺における書き込みを取得することが主となる。

したがって、以下のような設計はふさわしくないと言える。

- ユーザー起点に考えて投稿データをユーザ配下に配置
- 投稿を起点に考えて投稿データとユーザーデータを単純に分離

前者は、ユーザーを無視して投稿データをフィルタリングすることが困難であり、後者は特定ユーザーの投稿データをまとめて取得することが難しいという問題点がある。

以上の課題点を解決することを主眼におき、データベースは以下のような設計をとるものとした。

- **ユーザーデータ**のコレクションと**投稿データ**のコレクションの2つをそれぞれ最上位に作成。
- ユーザーデータには、該当ユーザーの投稿IDを記憶するためのフィールドを設ける。

こうすることで、ユーザーIDを起点として投稿IDを取得、その後投稿コレクションから該当の投稿を抽出といった操作が可能になる。
具体的には、下の図のような構造となる。※フィールド値は仮のものである。

![スクリーンショット 2022-08-15 12 31 47](https://user-images.githubusercontent.com/48154936/184572617-b67c9ab2-f82a-4a6d-a102-f0a83ffcb8c0.png)

### 登録データのプログラム上の定義

#### 投稿内容

投稿内容のデータは、データクラス`Post`により定義される。位置情報の保存方法に関しては検討中。

```kotlin
data class Post(
  val string postId;  // 投稿ID
  val string userid;   // ユーザーID
  val string content; // 投稿内容（テキスト）
  val List<string> attachedImages;  // 添付画像のパス
  val longitude;  // 該当の店舗の緯度
  val latitude;   // 経度
)
```

#### ユーザーデータ

ユーザーのプロフィールデータ（プロフィール画像・ID・自己紹介文など）は以下のデータクラス`UserData`に定義される。

```kotlin
data class UserData(
  val string userid; // ユーザーID
  val string displayName; // 表示名（ニックネーム）
  val string profileImage;  // プロフィール画像のFirebase Storage内のパス
)
```



